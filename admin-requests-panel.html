<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ | Ú©Ø§ÙˆÛŒØ§Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/svg+xml" href="https://cdn.grapesjs.com/workspaces/cmgvbwak408ja13nsemkia83b/assets/7e057c43-5d96-4c3a-a8fc-8bd5f6589a93__kavianpremiumbadgelogo.svg">
  
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      
      body {
          font-family: 'Vazirmatn', sans-serif;
          background: #f8fafc;
          color: #1a202c;
          direction: rtl;
      }
      
      .header {
          background: white;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }
      
      .header-content {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }
      
      .logo {
          display: flex;
          align-items: center;
          gap: 15px;
      }
      
      .logo img {
          width: 50px;
          height: 50px;
      }
      
      .logo-text h1 {
          color: #2563eb;
          font-size: 1.5rem;
      }
      
      .logo-text p {
          color: #6b7280;
          font-size: 0.875rem;
      }
      
      .admin-info {
          display: flex;
          align-items: center;
          gap: 15px;
      }
      
      .logout-btn {
          background: #dc2626;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
      }
      
      .main-container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 20px;
      }
      
      .stats-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 20px;
          margin-bottom: 30px;
      }
      
      .stat-card {
          background: white;
          padding: 25px;
          border-radius: 12px;
          text-align: center;
          box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }
      
      .stat-number {
          font-size: 2rem;
          font-weight: 900;
          color: #2563eb;
          margin-bottom: 5px;
      }
      
      .stat-label {
          color: #6b7280;
          font-weight: 600;
      }
      
      .requests-section {
          background: white;
          border-radius: 12px;
          padding: 30px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }
      
      .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 25px;
      }
      
      .section-title {
          font-size: 1.5rem;
          font-weight: 800;
          color: #1a202c;
      }
      
      .filter-tabs {
          display: flex;
          gap: 10px;
      }
      
      .filter-tab {
          padding: 8px 16px;
          border: 2px solid #e5e7eb;
          background: white;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          transition: all 0.3s;
      }
      
      .filter-tab.active {
          background: #2563eb;
          color: white;
          border-color: #2563eb;
      }
      
      .request-card {
          border: 2px solid #e5e7eb;
          border-radius: 12px;
          padding: 25px;
          margin-bottom: 20px;
          transition: all 0.3s;
      }
      
      .request-card:hover {
          box-shadow: 0 5px 20px rgba(0,0,0,0.1);
          transform: translateY(-2px);
      }
      
      .request-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
      }
      
      .request-id {
          font-weight: 800;
          color: #2563eb;
          font-size: 1.1rem;
      }
      
      .status-badge {
          padding: 6px 12px;
          border-radius: 20px;
          font-size: 0.875rem;
          font-weight: 700;
      }
      
      .status-pending {
          background: #fef3c7;
          color: #92400e;
      }
      
      .status-approved {
          background: #d1fae5;
          color: #065f46;
      }
      
      .status-rejected {
          background: #fee2e2;
          color: #991b1b;
      }
      
      .request-info {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 15px;
          margin-bottom: 20px;
      }
      
      .info-row {
          display: flex;
          flex-direction: column;
      }
      
      .info-label {
          font-size: 0.875rem;
          color: #6b7280;
          font-weight: 600;
          margin-bottom: 5px;
      }
      
      .info-value {
          font-weight: 700;
          color: #1a202c;
      }
      
      .request-purpose {
          background: #f8fafc;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
      }
      
      .request-purpose strong {
          color: #374151;
          display: block;
          margin-bottom: 8px;
      }
      
      .request-purpose p {
          color: #4b5563;
          line-height: 1.6;
      }
      
      .request-actions {
          display: flex;
          gap: 10px;
      }
      
      .btn {
          padding: 10px 20px;
          border: none;
          border-radius: 8px;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s;
          display: inline-flex;
          align-items: center;
          gap: 8px;
      }
      
      .btn-success {
          background: #10b981;
          color: white;
      }
      
      .btn-success:hover {
          background: #059669;
          transform: translateY(-1px);
      }
      
      .btn-danger {
          background: #ef4444;
          color: white;
      }
      
      .btn-danger:hover {
          background: #dc2626;
          transform: translateY(-1px);
      }
      
      .btn-info {
          background: #3b82f6;
          color: white;
      }
      
      .btn-secondary {
          background: #6b7280;
          color: white;
      }
      
      .credentials-info {
          background: #d1fae5;
          padding: 15px;
          border-radius: 8px;
          margin-top: 15px;
          display: flex;
          align-items: center;
          gap: 20px;
      }
      
      .credentials-info strong {
          color: #065f46;
      }
      
      .credentials-info span {
          background: white;
          padding: 5px 10px;
          border-radius: 4px;
          font-family: monospace;
          font-weight: 700;
      }
      
      .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: #6b7280;
      }
      
      .empty-state h3 {
          font-size: 1.5rem;
          margin-bottom: 10px;
      }
      
      .modal-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
      }
      
      .modal {
          background: white;
          border-radius: 12px;
          max-width: 600px;
          width: 90%;
          max-height: 80vh;
          overflow-y: auto;
      }
      
      .modal-header {
          padding: 20px;
          border-bottom: 1px solid #e5e7eb;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }
      
      .modal-close {
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #6b7280;
      }
      
      .modal-body {
          padding: 20px;
      }
      
      .modal-footer {
          padding: 20px;
          border-top: 1px solid #e5e7eb;
          display: flex;
          gap: 10px;
          justify-content: flex-end;
      }
      
      .form-group {
          margin-bottom: 20px;
      }
      
      .form-group label {
          display: block;
          margin-bottom: 5px;
          font-weight: 600;
          color: #374151;
      }
      
      .form-group input,
      .form-group textarea {
          width: 100%;
          padding: 10px;
          border: 2px solid #e5e7eb;
          border-radius: 8px;
          font-family: inherit;
      }
      
      .form-group input:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #2563eb;
      }
      
      .request-summary {
          background: #f8fafc;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
      }
      
      .access-features {
          background: #e0f2fe;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
      }
      
      .access-features ul {
          margin: 10px 0;
          padding-right: 20px;
      }
      
      .common-reasons {
          margin-top: 15px;
      }
      
      .common-reasons button {
          display: block;
          width: 100%;
          margin-bottom: 5px;
          padding: 8px;
          background: #f3f4f6;
          border: 1px solid #d1d5db;
          border-radius: 4px;
          cursor: pointer;
          text-align: right;
      }
      
      .common-reasons button:hover {
          background: #e5e7eb;
      }
      
      .loading-state {
          text-align: center;
          padding: 40px;
      }
      
      .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid #e5e7eb;
          border-top: 4px solid #2563eb;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto 20px;
      }
      
      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }
      
      @media (max-width: 768px) {
          .stats-grid {
              grid-template-columns: repeat(2, 1fr);
          }
          
          .request-info {
              grid-template-columns: 1fr;
          }
          
          .request-actions {
              flex-direction: column;
          }
      }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
      <div class="header-content">
          <div class="logo">
              <img src="https://cdn.grapesjs.com/workspaces/cmgvbwak408ja13nsemkia83b/assets/7e057c43-5d96-4c3a-a8fc-8bd5f6589a93__kavianpremiumbadgelogo.svg" alt="Ú©Ø§ÙˆÛŒØ§Ù†">
              <div class="logo-text">
                  <h1>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆÛŒØ§Ù†</h1>
                  <p>Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª</p>
              </div>
          </div>
          <div class="admin-info">
              <span>ğŸ‘¤ Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</span>
              <button class="logout-btn" onclick="adminLogout()">Ø®Ø±ÙˆØ¬</button>
          </div>
      </div>
  </header>

  <!-- Main Content -->
  <main class="main-container">
      <!-- Stats -->
      <div class="stats-grid">
          <div class="stat-card">
              <div class="stat-number" id="total-requests">0</div>
              <div class="stat-label">Ú©Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</div>
          </div>
          <div class="stat-card">
              <div class="stat-number" id="pending-requests">0</div>
              <div class="stat-label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
          </div>
          <div class="stat-card">
              <div class="stat-number" id="approved-requests">0</div>
              <div class="stat-label">ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</div>
          </div>
          <div class="stat-card">
              <div class="stat-number" id="rejected-requests">0</div>
              <div class="stat-label">Ø±Ø¯ Ø´Ø¯Ù‡</div>
          </div>
      </div>

      <!-- Requests Section -->
      <div class="requests-section">
          <div class="section-header">
              <h2 class="section-title">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª</h2>
              <div class="filter-tabs">
                  <button class="filter-tab active" onclick="filterRequests('all')">Ù‡Ù…Ù‡</button>
                  <button class="filter-tab" onclick="filterRequests('pending')">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</button>
                  <button class="filter-tab" onclick="filterRequests('approved')">ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</button>
                  <button class="filter-tab" onclick="filterRequests('rejected')">Ø±Ø¯ Ø´Ø¯Ù‡</button>
              </div>
          </div>
          
          <div id="requests-container">
              <!-- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
          </div>
      </div>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
      // ØªÙ†Ø¸ÛŒÙ…Ø§Øª EmailJS Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ù‚Ø¹ÛŒ
      const EMAIL_CONFIG = {
          publicKey: 'u3dfoUdeOTtWSAjk_',
          serviceId: 'service_kiv8uen',
          templateId: 'Universal Kavian Templat'
      };

      emailjs.init(EMAIL_CONFIG.publicKey);

      // Ø³Ø·ÙˆØ­ Ø¯Ø³ØªØ±Ø³ÛŒ
      const ACCESS_LEVELS = {
          viewer: {
              label: 'Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒÚ¯Ø±',
              features: [
                  'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ù†Ø§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ',
                  'Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø±Ø§Ù‡Ù†Ù…Ø§Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡',
                  'Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡'
              ]
          },
          analyst: {
              label: 'ØªØ­Ù„ÛŒÙ„Ú¯Ø±',
              features: [
                  'ØªÙ…Ø§Ù… Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒÚ¯Ø±',
                  'Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ÛŒ',
                  'Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ',
                  'Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡'
              ]
          },
          engineer: {
              label: 'Ù…Ù‡Ù†Ø¯Ø³',
              features: [
                  'ØªÙ…Ø§Ù… Ø§Ù…Ú©Ø§Ù†Ø§Øª ØªØ­Ù„ÛŒÙ„Ú¯Ø±',
                  'Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ú©Ø§Ù…Ù„',
                  'Ø±Ø§Ù‡Ù†Ù…Ø§Ù‡Ø§ÛŒ ÙÙ†ÛŒ ØªØ®ØµØµÛŒ',
                  'Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¹Ø¯Ù†ÛŒ',
                  'Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ'
              ]
          },
          manager: {
              label: 'Ù…Ø¯ÛŒØ± Ù¾Ø±ÙˆÚ˜Ù‡',
              features: [
                  'ØªÙ…Ø§Ù… Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù…Ù‡Ù†Ø¯Ø³',
                  'Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡',
                  'Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ',
                  'ØªØ­Ù„ÛŒÙ„ Ø§Ù‚ØªØµØ§Ø¯ÛŒ',
                  'Ù…Ø¯ÛŒØ±ÛŒØª ØªÛŒÙ… Ùˆ Ù…Ù†Ø§Ø¨Ø¹'
              ]
          }
      };

      // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†
      function checkAdminAccess() {
          const adminCredentials = {
              'admin': 'admin123',
              'manager': 'mgr456'
          };
          
          const savedAdmin = localStorage.getItem('adminLogin');
          if (savedAdmin) {
              try {
                  const adminData = JSON.parse(savedAdmin);
                  const loginTime = new Date(adminData.loginTime);
                  const now = new Date();
                  const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                  
                  if (hoursDiff < 8) {
                      return true;
                  }
              } catch (error) {
                  localStorage.removeItem('adminLogin');
              }
          }
          
          const username = prompt('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø¯Ù…ÛŒÙ†:');
          const password = prompt('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø¯Ù…ÛŒÙ†:');
          
          if (adminCredentials[username] === password) {
              localStorage.setItem('adminLogin', JSON.stringify({
                  username,
                  loginTime: new Date().toISOString()
              }));
              return true;
          }
          
          return false;
      }

      // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
      function getRequests() {
          return JSON.parse(localStorage.getItem('pendingRequests') || '[]');
      }

      // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
      function saveRequests(requests) {
          localStorage.setItem('pendingRequests', JSON.stringify(requests));
      }

      // Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
      function getApprovedUsers() {
          return JSON.parse(localStorage.getItem('approvedUsers') || '[]');
      }

      // Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
      function saveApprovedUsers(users) {
          localStorage.setItem('approvedUsers', JSON.stringify(users));
      }

      // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
      function displayRequests() {
          const requests = getRequests();
          const container = document.getElementById('requests-container');
          
          if (requests.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <h3>Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
                      <p>Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.</p>
                  </div>
              `;
              return;
          }
          
          container.innerHTML = requests.map(request => `
              <div class="request-card" data-status="${request.status}">
                  <div class="request-header">
                      <div class="request-id">${request.requestId}</div>
                      <div class="status-badge status-${request.status}">
                          ${getStatusLabel(request.status)}
                      </div>
                  </div>
                  
                  <div class="request-info">
                      <div class="info-row">
                          <span class="info-label">Ù†Ø§Ù…:</span>
                          <span class="info-value">${request.firstName} ${request.lastName}</span>
                      </div>
                      <div class="info-row">
                          <span class="info-label">Ø§ÛŒÙ…ÛŒÙ„:</span>
                          <span class="info-value">${request.email}</span>
                      </div>
                      <div class="info-row">
                          <span class="info-label">Ø´Ø±Ú©Øª:</span>
                          <span class="info-value">${request.company}</span>
                      </div>
                      <div class="info-row">
                          <span class="info-label">Ø³Ø·Ø­ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ:</span>
                          <span class="info-value">${ACCESS_LEVELS[request.accessLevel]?.label || request.accessLevel}</span>
                      </div>
                      <div class="info-row">
                          <span class="info-label">ØªØ§Ø±ÛŒØ®:</span>
                          <span class="info-value">${new Date(request.submittedAt).toLocaleDateString('fa-IR')}</span>
                      </div>
                      <div class="info-row">
                          <span class="info-label">ØªÙ„ÙÙ†:</span>
                          <span class="info-value">${request.phone}</span>
                      </div>
                  </div>
                  
                  <div class="request-purpose">
                      <strong>Ù‡Ø¯Ù:</strong>
                      <p>${request.purpose}</p>
                  </div>
                  
                  <div class="request-actions">
                      ${request.status === 'pending' ? `
                          <button class="btn btn-success" onclick="showApprovalModal('${request.requestId}')">
                              âœ… ØªØ£ÛŒÛŒØ¯
                          </button>
                          <button class="btn btn-danger" onclick="showRejectionModal('${request.requestId}')">
                              âŒ Ø±Ø¯
                          </button>
                      ` : ''}
                      <button class="btn btn-info" onclick="viewRequestDetails('${request.requestId}')">
                          ğŸ‘ï¸ Ø¬Ø²Ø¦ÛŒØ§Øª
                      </button>
                  </div>
                  
                  ${request.credentials ? `
                      <div class="credentials-info">
                          <strong>Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯:</strong>
                          <span>ğŸ‘¤ ${request.credentials.username}</span>
                          <span>ğŸ”‘ ${request.credentials.password}</span>
                      </div>
                  ` : ''}
              </div>
          `).join('');
      }

      // Ø¨Ø±Ú†Ø³Ø¨ ÙˆØ¶Ø¹ÛŒØª
      function getStatusLabel(status) {
          const labels = {
              pending: 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
              approved: 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡',
              rejected: 'Ø±Ø¯ Ø´Ø¯Ù‡'
          };
          return labels[status] || status;
      }

      // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ ØªØ£ÛŒÛŒØ¯
      function showApprovalModal(requestId) {
          const request = getRequests().find(r => r.requestId === requestId);
          if (!request) return;
          
          const modal = document.createElement('div');
          modal.className = 'modal-overlay';
          modal.innerHTML = `
              <div class="modal">
                  <div class="modal-header">
                      <h3>ØªØ£ÛŒÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¹Ø¶ÙˆÛŒØª</h3>
                      <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                  </div>
                  
                  <div class="modal-body">
                      <div class="request-summary">
                          <h4>${request.firstName} ${request.lastName}</h4>
                          <p>Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ: ${ACCESS_LEVELS[request.accessLevel]?.label}</p>
                          <p>Ø´Ø±Ú©Øª: ${request.company}</p>
                      </div>
                      
                      <div class="access-features">
                          <h4>Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø§ÛŒÙ† Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ:</h4>
                          <ul>
                              ${ACCESS_LEVELS[request.accessLevel]?.features.map(feature => `<li>${feature}</li>`).join('') || ''}
                          </ul>
                      </div>
                      
                      <div class="form-group">
                          <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                          <input type="text" id="custom-username" placeholder="Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯">
                      </div>
                      <div class="form-group">
                          <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                          <input type="text" id="custom-password" placeholder="Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯">
                      </div>
                  </div>
                  
                  <div class="modal-footer">
                      <button class="btn btn-success" onclick="confirmApproval('${requestId}')">
                          âœ… ØªØ£ÛŒÛŒØ¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
                      </button>
                      <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">
                          Ø§Ù†ØµØ±Ø§Ù
                      </button>
                  </div>
              </div>
          `;
          
          document.body.appendChild(modal);
      }

      // ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ
      async function confirmApproval(requestId) {
          const customUsername = document.getElementById('custom-username').value.trim();
          const customPassword = document.getElementById('custom-password').value.trim();
          
          const requests = getRequests();
          const request = requests.find(r => r.requestId === requestId);
          
          if (!request) {
              alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛŒØ§ÙØª Ù†Ø´Ø¯!');
              return;
          }
          
          // ØªÙˆÙ„ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯
          const credentials = generateCredentials(request.accessLevel, customUsername, customPassword);
          
          // Ù†Ù…Ø§ÛŒØ´ loading
          const modal = document.querySelector('.modal-overlay');
          modal.querySelector('.modal-body').innerHTML = `
              <div class="loading-state">
                  <div class="spinner"></div>
                  <p>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ ØªØ£ÛŒÛŒØ¯...</p>
              </div>
          `;
          
          try {
              // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ…ÛŒÙ„
              const emailData = {
                  if_membership_request: false,
                  if_approval: true,
                  if_rejection: false,
                  
                  to_name: `${request.firstName} ${request.lastName}`,
                  to_email: request.email,
                  request_id: requestId,
                  username: credentials.username,
                  password: credentials.password,
                  access_level: ACCESS_LEVELS[request.accessLevel]?.label,
                  activation_date: new Date().toLocaleDateString('fa-IR'),
                  login_url: `${window.location.origin}/technical-login.html`
              };
              
              // Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
              const result = await emailjs.send(
                  EMAIL_CONFIG.serviceId,
                  EMAIL_CONFIG.templateId,
                  emailData
              );
              
              console.log('âœ… Ø§ÛŒÙ…ÛŒÙ„ ØªØ£ÛŒÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯:', result);
              
              // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
              request.status = 'approved';
              request.approvedAt = new Date().toISOString();
              request.credentials = credentials;
              
              // Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø± ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
              const approvedUsers = getApprovedUsers();
              approvedUsers.push({
                  ...request,
                  ...credentials,
                  isActive: true,
                  permissions: getPermissions(request.accessLevel)
              });
              saveApprovedUsers(approvedUsers);
              
              saveRequests(requests);
              
              modal.remove();
              alert('âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ£ÛŒÛŒØ¯ Ø´Ø¯ Ùˆ Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!');
              displayRequests();
              updateStats();
              
          } catch (error) {
              console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„:', error);
              alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„: ' + (error.text || error.message));
              modal.remove();
          }
      }

      // ØªÙˆÙ„ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯
      function generateCredentials(accessLevel, customUsername, customPassword) {
          const levelPrefixes = {
              viewer: 'view',
              analyst: 'anl',
              engineer: 'eng',
              manager: 'mgr'
          };
          
          let username = customUsername;
          if (!username) {
              const prefix = levelPrefixes[accessLevel] || 'user';
              const timestamp = Date.now().toString().slice(-4);
              username = `${prefix}_${timestamp}`;
          }
          
          let password = customPassword;
          if (!password) {
              const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789';
              password = '';
              for (let i = 0; i < 8; i++) {
                  password += chars.charAt(Math.floor(Math.random() * chars.length));
              }
          }
          
          return { username, password };
      }

      // Ø¯Ø±ÛŒØ§ÙØª Ù…Ø¬ÙˆØ²Ù‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ
      function getPermissions(accessLevel) {
          const permissions = {
              viewer: ['view_basic', 'download_public'],
              analyst: ['view_basic', 'view_analysis', 'download_reports', 'use_calculators'],
              engineer: ['view_basic', 'view_analysis', 'view_engineering', 'download_all', 'use_advanced_tools'],
              manager: ['view_all', 'download_all', 'use_all_tools', 'project_management']
          };
          return permissions[accessLevel] || ['view_basic'];
      }

      // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø±Ø¯
      function showRejectionModal(requestId) {
          const request = getRequests().find(r => r.requestId === requestId);
          if (!request) return;
          
          const modal = document.createElement('div');
          modal.className = 'modal-overlay';
          modal.innerHTML = `
              <div class="modal">
                  <div class="modal-header">
                      <h3>Ø±Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¹Ø¶ÙˆÛŒØª</h3>
                      <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                  </div>
                  
                  <div class="modal-body">
                      <div class="request-summary">
                          <h4>${request.firstName} ${request.lastName}</h4>
                          <p>Ø§ÛŒÙ…ÛŒÙ„: ${request.email}</p>
                          <p>Ø´Ø±Ú©Øª: ${request.company}</p>
                        </div>
                        
                        <div class="form-group">
                            <label>Ø¯Ù„ÛŒÙ„ Ø±Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª:</label>
                            <textarea id="rejection-reason" placeholder="Ù„Ø·ÙØ§Ù‹ Ø¯Ù„ÛŒÙ„ Ø±Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯..." required></textarea>
                        </div>
                        
                        <div class="common-reasons">
                            <h4>Ø¯Ù„Ø§ÛŒÙ„ Ù…ØªØ¯Ø§ÙˆÙ„:</h4>
                            <button type="button" onclick="document.getElementById('rejection-reason').value = this.textContent">
                                Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ Ù†Ø§Ú©Ø§ÙÛŒ Ø§Ø³Øª
                            </button>
                            <button type="button" onclick="document.getElementById('rejection-reason').value = this.textContent">
                                Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øª
                            </button>
                            <button type="button" onclick="document.getElementById('rejection-reason').value = this.textContent">
                                Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù†ÛŒØ³Øª
                            </button>
                            <button type="button" onclick="document.getElementById('rejection-reason').value = this.textContent">
                                Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ Ù‚Ø§Ø¨Ù„ ØªØ£ÛŒÛŒØ¯ Ù†ÛŒØ³Øª
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button class="btn btn-danger" onclick="confirmRejection('${requestId}')">
                            âŒ Ø±Ø¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
                        </button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">
                            Ø§Ù†ØµØ±Ø§Ù
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Ø±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ
        async function confirmRejection(requestId) {
            const reason = document.getElementById('rejection-reason').value.trim();
            
            if (!reason) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø¯Ù„ÛŒÙ„ Ø±Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            const requests = getRequests();
            const request = requests.find(r => r.requestId === requestId);
            
            if (!request) {
                alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛŒØ§ÙØª Ù†Ø´Ø¯!');
                return;
            }
            
            const modal = document.querySelector('.modal-overlay');
            modal.querySelector('.modal-body').innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ...</p>
                </div>
            `;
            
            try {
                // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ…ÛŒÙ„
                const emailData = {
                    if_membership_request: false,
                    if_approval: false,
                    if_rejection: true,
                    
                    to_name: `${request.firstName} ${request.lastName}`,
                    to_email: request.email,
                    request_id: requestId,
                    rejection_reason: reason
                };
                
                // Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
                const result = await emailjs.send(
                    EMAIL_CONFIG.serviceId,
                    EMAIL_CONFIG.templateId,
                    emailData
                );
                
                console.log('âœ… Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯:', result);
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
                request.status = 'rejected';
                request.rejectedAt = new Date().toISOString();
                request.rejectionReason = reason;
                
                saveRequests(requests);
                
                modal.remove();
                alert('âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø¯ Ø´Ø¯ Ùˆ Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!');
                displayRequests();
                updateStats();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„: ' + (error.text || error.message));
                modal.remove();
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
        function viewRequestDetails(requestId) {
            const request = getRequests().find(r => r.requestId === requestId);
            if (!request) return;
            
            const details = `
Ø´Ù†Ø§Ø³Ù‡: ${request.requestId}
Ù†Ø§Ù…: ${request.firstName} ${request.lastName}
Ø§ÛŒÙ…ÛŒÙ„: ${request.email}
ØªÙ„ÙÙ†: ${request.phone}
Ø´Ø±Ú©Øª: ${request.company}
Ø³Ù…Øª: ${request.position || 'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡'}
Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ: ${ACCESS_LEVELS[request.accessLevel]?.label}
Ø³Ø§Ø¨Ù‚Ù‡: ${request.experience || 'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡'}
Ù†ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡: ${request.projectType || 'Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡'}
ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø®ÙˆØ§Ø³Øª: ${new Date(request.submittedAt).toLocaleString('fa-IR')}
ÙˆØ¶Ø¹ÛŒØª: ${getStatusLabel(request.status)}

Ù‡Ø¯Ù Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡:
${request.purpose}

${request.additionalInfo ? `Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ:\n${request.additionalInfo}` : ''}

${request.credentials ? `Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯:\nÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${request.credentials.username}\nØ±Ù…Ø² Ø¹Ø¨ÙˆØ±: ${request.credentials.password}` : ''}

${request.rejectionReason ? `Ø¯Ù„ÛŒÙ„ Ø±Ø¯: ${request.rejectionReason}` : ''}
            `;
            
            alert(details);
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
        function updateStats() {
            const requests = getRequests();
            
            document.getElementById('total-requests').textContent = requests.length;
            document.getElementById('pending-requests').textContent = requests.filter(r => r.status === 'pending').length;
            document.getElementById('approved-requests').textContent = requests.filter(r => r.status === 'approved').length;
            document.getElementById('rejected-requests').textContent = requests.filter(r => r.status === 'rejected').length;
        }

        // ÙÛŒÙ„ØªØ± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
        function filterRequests(status) {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¨ ÙØ¹Ø§Ù„
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
            const cards = document.querySelectorAll('.request-card');
            cards.forEach(card => {
                if (status === 'all' || card.dataset.status === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Ø®Ø±ÙˆØ¬ Ø§Ø¯Ù…ÛŒÙ†
        function adminLogout() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
                localStorage.removeItem('adminLogin');
                window.location.href = './index.html';
            }
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†...');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†
            if (!checkAdminAccess()) {
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; text-align: center; flex-direction: column;">
                        <h1 style="color: #dc2626;">ğŸ”’ Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²</h1>
                        <p style="color: #6b7280; margin: 20px 0;">Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù† Ø³ÛŒØ³ØªÙ… Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª.</p>
                        <a href="./index.html" style="background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px;">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
                    </div>
                `;
                return;
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
            displayRequests();
            updateStats();
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
            setInterval(() => {
                displayRequests();
                updateStats();
            }, 30000);
            
            console.log('âœ… Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!');
        });

    </script>
</body>
</html>
